{% extends "layout.html" %}
{% load utils_extras %}
{% block body %} 
<div class="pure-g">
    <div class="pure-u-1-2">
        <h1>{{ book.title }}</h1>
        <p><strong>{% trans "author"|capfirst %} : </strong></p>
        <p>
        	{{ book.author|default:_("unknown")|capfirst }}</p>
        <p><strong>{% trans "cover"|capfirst %} : </strong></p>
        <p>
        	{% if book.cover %}<img src="{{ book.cover.url }}" class="cover" />{% else %}<img src="{% static 'img/book_cover.png' %}" class="cover" />{% endif %}</p>
        <p><strong>{% trans "editor"|capfirst %} : </strong></p>
        <p>
        	{{ book.editor|default:_("unknown")|capfirst }}</p>
        <p><strong>{% trans "published"|capfirst %} : </strong></p>
        <p>
        	{{ book.publishing_date|naturalday:"DATE_FORMAT"|default:_("unknown")|capfirst }}</p>
        <p><strong>{% trans "themes"|capfirst %}</strong></p>
        <p>
            {% if book.themes.all|length > 0 %}
                <ul>
                {% for theme in book.themes.all %}
                    <li>{{theme}}</li>
                {% endfor %}
                </ul>
            {% else %}
                <p> {% trans "empty"|capfirst %}</p>
            {% endif %}
        </p>
        <p><strong>{% trans "periods"|capfirst %}</strong></p>
        <p>
            {% if book.periods.all|length > 0 %}
                <ul>
                {% for period in book.periods.all %}
                    <li>{{period}}</li>
                {% endfor %}
                </ul>
            {% else %}
                <p> {% trans "empty"|capfirst %}</p>
            {% endif %}
        </p>
        <p><strong>{% trans "summary"|capfirst %}</strong></p>
        <blockquote>
			{{ book.summary|default:_("not filled yet")|capfirst|safe }}</blockquote>
        <p><strong>{% trans "owned by"|capfirst %}</strong></p>
    </div>
    <div class="pure-u-1-2">
    <h2>{% trans "options"|capfirst %}</h2>
    <p>
        {% if book.owners.all %}
                {% if perms.library.book_remove_from_all_libraries %}
                    <a class="pure-button pure-button-warning" href="{% url "book_remove_from_library" book.id %}">{% trans "remove"|capfirst %}</a>
                {% elif perms.library.book_remove_from_library and request.user in book.owners.all %}
                    <a class="pure-button pure-button-xsmall pure-button-warning" href="{% url "book_remove_from_library" book.id %}">{% trans "remove"|capfirst %}</a>
                {% endif %}
        {% endif %}
        {% if not request.user in book.owners.all %}
            <a class="pure-button pure-button-success" href="{% url "book_add_this_to_my_library" book.id %}">{% trans "add"|capfirst %}</a> 
        {% endif %}
        {% if perms.library.book_edit or perms.library.book_delete %}
            {% if perms.library.book_edit %}
            <a class="pure-button pure-button-secondary" href="{% url "book_edit" book.id %}">{% trans "edit"|capfirst %}</a>
            {% endif %}
            {% if perms.library.book_delete %}
            <a class="pure-button pure-button-error" href="{% url "book_delete" book.id %}">{% trans "delete"|capfirst %}</a>
            {% endif %}
        {% endif %}
        </p>
    	{% include "common/lendings.html" %}
    </div>
</div>
{% if perms.library.ownership_new %}
    
        <p><a class="pure-button pure-button-primary" href="{% url "book_add_this_to_my_library" book.id %}">{% trans "new"|capfirst %}</a></p>
    {% endif %}
{% if ownerships.all %}
<div class="book_collection">
    {% for ownership in ownerships.all %}
    <div class="pure-g border">
        <div class="pure-u-1-6 book">
            <p class="cover">    
                {% if ownership.cover %}<img src="{{ ownership.cover.url }}" class="cover" />{% else %}<img src="{% static 'img/book_cover.png' %}" class="cover" />{% endif %}
            </p>
            <p>
             {{ ownership.editor|default:_("unknown")|capfirst }}
             ({{ book.publishing_date|naturalday:"DATE_FORMAT"|default:_("unknown") }})</p>
            <p><a href="{% url "profile_show" ownership.id %}">{% blocktrans with owner=ownership.owner.username|default:_("unknown")|capfirst nbcopies=ownership.copies %}{{owner}} ({{nbcopies}}){% endblocktrans %}</a></p>
        </div>
        <div class="pure-u-2-3">
            <p>
                {% if ownership.comments and ownership.comments.strip %}
                    {{ ownership.comments|safe }}
                {% else %}
                    {% trans "no comment on this book"|capfirst %}
                {% endif %}
            </p>
            <p>
                {% if perms.library.ownership_edit or perms.library.ownership_delete %}
                    {% if perms.library.ownership_edit %}
                    <a class="pure-button pure-button-secondary" href="{% url "ownership_edit" ownership.id %}">{% trans "edit"|capfirst %}</a>
                    {% endif %}
                    {% if perms.library.ownership_delete %}
                    <a class="pure-button pure-button-error" href="{% url "ownership_delete" ownership.id %}">{% trans "delete"|capfirst %}</a>
                    {% endif %}
                {% endif %}
            </p>
        </div>
        <div class="pure-u-1-6 font_smaller">
        {% with lendings=lendings_ordered|keyvalue:ownership.id %}
            {% include "common/lendings.html" %}
        {% endwith %}
        </div>
    </div>
    {% endfor %}
    {% if perms.library.ownership_new %}
    
        <p><a class="pure-button pure-button-primary" href="{% url "book_add_this_to_my_library" book.id %}">{% trans "new"|capfirst %}</a></p>
    {% endif %}
{% else %}
        <p>{% trans "unknown"|capfirst %}</p>
        {% if perms.library.ownership_new %}
        <p><a class="pure-button pure-button-primary" href="{% url "book_add_this_to_my_library" book.id %}">{% trans "new"|capfirst %}</a></p>
    {% endif %}
{% endif %}
{% endblock %}
